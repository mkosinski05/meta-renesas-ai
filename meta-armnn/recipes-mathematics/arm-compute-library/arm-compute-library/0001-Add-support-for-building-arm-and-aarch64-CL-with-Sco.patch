From 3e2da8706a30b5bdfd09d7314de2c445342b97a6 Mon Sep 17 00:00:00 2001
From: Gareth Williams <gareth.williams.jx@renesas.com>
Date: Wed, 9 Jun 2021 16:17:17 +0100
Subject: [PATCH] Add support for building arm and aarch64 CL with Scons

Recreated for arm_compute v20.11, with support for Arm V8.2
cores.

Signed-off-by: Jianming Qiao <jianming.qiao@bp.renesas.com>
Signed-off-by: Gareth Williams <gareth.williams.jx@renesas.com>
---
 SConstruct | 12 ++++--------
 1 file changed, 4 insertions(+), 8 deletions(-)

diff --git a/SConstruct b/SConstruct
index 274326f..5dad742 100644
--- a/SConstruct
+++ b/SConstruct
@@ -206,11 +206,11 @@ if 'v7a' in env['estate'] and env['estate'] == '64':
 # Add architecture specific flags
 prefix = ""
 if 'v7a' in env['arch']:
-    env.Append(CXXFLAGS = ['-march=armv7-a', '-mthumb', '-mfpu=neon'])
+    env.Append(CXXFLAGS = ['-mthumb', '-mfpu=neon'])
     if env['os'] == 'android' or env['os'] == 'tizen':
         env.Append(CXXFLAGS = ['-mfloat-abi=softfp'])
     else:
-        env.Append(CXXFLAGS = ['-mfloat-abi=hard'])
+        env.Append(CXXFLAGS = ['-mfloat-abi=hard','-fPIC'])
 elif 'v8' in env['arch']:
     if 'sve2' in env['arch']:
         env.Append(CXXFLAGS = ['-march=armv8.2-a+sve2+fp16+dotprod'])
@@ -221,8 +221,6 @@ elif 'v8' in env['arch']:
         env.Append(CXXFLAGS = ['-march=armv8.4-a'])
     elif 'v8.' in env['arch']:
         env.Append(CXXFLAGS = ['-march=armv8.2-a+fp16']) # explicitly enable fp16 extension otherwise __ARM_FEATURE_FP16_VECTOR_ARITHMETIC is undefined
-    else:
-        env.Append(CXXFLAGS = ['-march=armv8-a'])
 
     if 'v8.6-a' in env['arch']:
         env.Append(CPPDEFINES = ['MMLA_INT8', 'V8P6', 'V8P6_BF', 'ARM_COMPUTE_FORCE_BF16'])
@@ -241,9 +239,7 @@ elif 'x86' in env['arch']:
 prefix = ""
 if 'x86' not in env['arch']:
     if env['estate'] == '32':
-        if env['os'] == 'linux':
-            prefix = "arm-linux-gnueabihf-" if 'v7' in env['arch'] else "armv8l-linux-gnueabihf-"
-        elif env['os'] == 'bare_metal':
+        if env['os'] == 'bare_metal':
             prefix = "arm-eabi-"
         elif env['os'] == 'android':
             prefix = "arm-linux-androideabi-"
@@ -251,7 +247,7 @@ if 'x86' not in env['arch']:
             prefix = "armv7l-tizen-linux-gnueabi-"
     elif env['estate'] == '64' and 'v8' in env['arch']:
         if env['os'] == 'linux':
-            prefix = "aarch64-linux-gnu-"
+            env.Append(CXXFLAGS = ['-fPIC'])
         elif env['os'] == 'bare_metal':
             prefix = "aarch64-elf-"
         elif env['os'] == 'android':
-- 
2.7.4

